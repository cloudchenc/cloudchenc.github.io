---
title: 卡顿优化
tags:
categories: 性能优化
---

尽量提供一些具体的实例来展示信息

工具：

Systrace

TraceView

使用 Systrace 和 TraceView 来分析耗时

从实现原理引申出框架

原理：主线程的消息队列机制

1. 通过消息队列输入输出的时间差，同阈值进行对比
2. 开启线程，定时向主线程发送消息，记录发送时间，同主线程的执行时间进行对比

当判断为卡顿后，打印当前主线程的堆栈信息，但是有可能真正卡顿的方法已经执行过了，
那么可以获取多个堆栈的信息，过滤筛选重复的堆栈调用，会大概率找到耗时方法。

需要获取的一些信息：

手机信息：手机型号，系统版本，进程名称，应用版本，内置存储等
耗时信息：卡顿开始和结束时间
CPU使用信息：CPU信息，整体CPU使用率和本进程使用率
堆栈信息：

线下和线上的监控